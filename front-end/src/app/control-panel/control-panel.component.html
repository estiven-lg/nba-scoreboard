<div class="container mx-auto mt-4 space-y-6">

  <form [formGroup]="controlForm" class="space-y-6">

    <!-- âš™ï¸ ConfiguraciÃ³n Inicial -->
    <h3 class="text-lg font-semibold">âš™ï¸ ConfiguraciÃ³n Inicial</h3>

    <!-- ğŸ”„ Continuar un partido existente -->
    <div class="flex flex-wrap gap-2 mb-3">
      <input
        type="number"
        class="border rounded px-3 py-2 w-40"
        placeholder="ID del partido"
        [(ngModel)]="existingGameId"
        [ngModelOptions]="{standalone: true}"
      />

      <button
        class="bg-blue-600 text-white rounded px-4 py-2 hover:bg-blue-700"
        (click)="continueGame()"
        [disabled]="!existingGameId"
      >
        Continuar Partido
      </button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
      <div>
        <label class="block mb-1">Equipo Local</label>
        <select class="w-full border rounded px-3 py-2" formControlName="homeTeam" (change)="onTeamChange()" >
          <option value="">Seleccione equipo</option>
          <option *ngFor="let team of homeTeams; trackBy: trackByTeamId" [value]="team.teamId">
            {{ team.name }} ({{ team.city }})
          </option>
        </select>
      </div>

      <div>
        <label class="block mb-1">Equipo Visitante</label>
        <select class="w-full border rounded px-3 py-2" formControlName="visitorTeam" (change)="onTeamChange()" >
          <option value="">Seleccione equipo</option>
          <option *ngFor="let team of visitorTeams; trackBy: trackByTeamId" [value]="team.teamId">
            {{ team.name }} ({{ team.city }})
          </option>
        </select>
      </div>
    </div>

    <div class="flex flex-wrap gap-2 mb-3">
      <button
        class="bg-purple-600 text-white rounded px-4 py-2 hover:bg-purple-700"
        (click)="createGame()"
        [disabled]="!controlForm.valid || !canInteract"
      >
        Crear Partido
      </button>
      <div *ngIf="errorMessage" class="text-red-600 mb-2">
        {{ errorMessage }}
      </div>
    </div>

    <div *ngIf="!gameId" class="text-red-600 mb-3">
      âš ï¸ Debe crear un juego antes de iniciar el partido.
    </div>

    <!-- ğŸ† Flujo del Partido -->
    <h3 class="text-lg font-semibold">ğŸ† Flujo del Partido</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
      <div>
        <label class="block mb-1">DuraciÃ³n del periodo (minutos)</label>
        <input type="number" class="w-full border rounded px-3 py-2" formControlName="periodMinutes"  />
      </div>
      <div>
        <label class="block mb-1">Estado del partido</label>
        <input type="text" class="w-full border rounded px-3 py-2 bg-gray-100" formControlName="gameStatus" [value]="getGameStatusName(controlForm.value.gameStatus)" readonly />
      </div>
      <div>
        <label class="block mb-1">Periodo Actual</label>
        <input type="text" class="w-full border rounded px-3 py-2 bg-gray-100" [value]="currentQuarter + '/' + quartersTotal" readonly />
      </div>
    </div>

    <!-- Botones de Control -->
    <div class="flex flex-wrap gap-2 mb-3">
      <button class="bg-green-600 text-white rounded px-4 py-2 hover:bg-green-700" (click)="startGame()" [disabled]="!gameId || !canInteract">Iniciar Partido</button>
      <button class="bg-orange-500 text-white rounded px-4 py-2 hover:bg-orange-600" (click)="pauseGame()" [disabled]="!gameId || !canInteract">Pausar</button>
      <button class="bg-blue-600 text-white rounded px-4 py-2 hover:bg-blue-700" (click)="resumeGame()" [disabled]="!gameId || !canInteract">Reanudar</button>
      <button class="bg-gray-600 text-white rounded px-4 py-2 hover:bg-gray-700" (click)="resetPeriod()" [disabled]="!gameId || !canInteract">Reiniciar Periodo</button>
      <button class="bg-teal-500 text-white rounded px-4 py-2 hover:bg-teal-600" (click)="nextQuarter()" [disabled]="!gameId || !canInteract">Siguiente Periodo</button>
      <button class="bg-red-600 text-white rounded px-4 py-2 hover:bg-red-700" (click)="suspendGame()" [disabled]="!gameId || !canInteract">Suspender</button>
      <button
        class="bg-black text-white rounded px-4 py-2 hover:bg-gray-800"
        (click)="finishGame()"
        [disabled]="!gameId || !canInteract || controlForm.value.gameStatus === GameStatus.FINISHED"
      >
        ğŸ”š Finalizar Partido
      </button>
    </div>

    <hr class="my-4 border-gray-300" />

    <!-- â›¹ï¸â€â™‚ï¸ Anotaciones y Faltas -->
    <h3 class="text-lg font-semibold">â›¹ï¸â€â™‚ï¸ Anotaciones y Faltas</h3>

    <!-- Puntos -->
    <div class="flex flex-wrap gap-2 mb-3">
      <h5 class="w-full">Puntos</h5>
      <button class="bg-green-600 text-white rounded px-4 py-2 hover:bg-green-700" (click)="addPoints('home', 2)" [disabled]="!canInteract">ğŸ  Local +2</button>
      <button class="bg-green-600 text-white rounded px-4 py-2 hover:bg-green-700" (click)="addPoints('home', 3)" [disabled]="!canInteract">ğŸ  Local +3</button>
      <button class="bg-blue-600 text-white rounded px-4 py-2 hover:bg-blue-700" (click)="addPoints('visitor', 2)" [disabled]="!canInteract">âœˆï¸ Visitante +2</button>
      <button class="bg-blue-600 text-white rounded px-4 py-2 hover:bg-blue-700" (click)="addPoints('visitor', 3)" [disabled]="!canInteract">âœˆï¸ Visitante +3</button>
    </div>

    <!-- Faltas de equipo -->
    <div class="flex flex-wrap gap-2 mb-3">
      <h5 class="w-full">Faltas de Equipo</h5>
      <button class="bg-purple-600 text-white rounded px-4 py-2 hover:bg-purple-700" (click)="addTeamFoul('home')" [disabled]="!canInteract">ğŸ  Falta Equipo Local</button>
      <button class="bg-indigo-600 text-white rounded px-4 py-2 hover:bg-indigo-700" (click)="addTeamFoul('visitor')" [disabled]="!canInteract">âœˆï¸ Falta Equipo Visitante</button>
    </div>

    <!-- Faltas Jugadores -->
    <div class="flex flex-col md:flex-row gap-6 mb-3">
      <div class="flex-1">
        <label class="block mb-1">Jugador Local</label>
        <div class="flex gap-2">
          <select class="w-full border rounded px-3 py-2" formControlName="homePlayer" >
            <option value="">Seleccione jugador</option>
            <option *ngFor="let player of homePlayers; trackBy: trackByPlayerId" [value]="player.playerId">
              {{ player.fullName }}
            </option>
          </select>
          <button class="bg-red-600 text-white rounded px-4 py-2 hover:bg-red-700"
                  (click)="addPlayerFoul(controlForm.value.homePlayer)"
                  [disabled]="!controlForm.value.homePlayer || !canInteract">
            ğŸ  Falta
          </button>
        </div>
      </div>

      <div class="flex-1">
        <label class="block mb-1">Jugador Visitante</label>
        <div class="flex gap-2">
          <select class="w-full border rounded px-3 py-2" formControlName="visitorPlayer" >
            <option value="">Seleccione jugador</option>
            <option *ngFor="let player of visitorPlayers; trackBy: trackByPlayerId" [value]="player.playerId">
              {{ player.fullName }}
            </option>
          </select>
          <button class="bg-red-600 text-white rounded px-4 py-2 hover:bg-red-700"
                  (click)="addPlayerFoul(controlForm.value.visitorPlayer)"
                  [disabled]="!controlForm.value.visitorPlayer || !canInteract">
            âœˆï¸ Falta
          </button>
        </div>
      </div>
    </div>

    <hr class="my-4 border-gray-300" />

    <!-- ğŸ“Š Estado del Juego -->
    <h3 class="text-lg font-semibold mt-6">ğŸ“Š Estado del Juego</h3>
    <div *ngIf="gameState; else noData" class="border rounded p-4 bg-gray-50">

      <p><b>ID:</b> {{ gameState?.gameId }}</p>
      <p><b>Fecha:</b> {{ gameState?.gameDate | date:'short' }}</p>
      <p><b>Estado:</b> {{ getGameStatusName(gameState?.gameStatus) }}</p>
      <p><b>PerÃ­odo actual:</b> {{ gameState?.currentPeriod }}</p>
      <p><b>Tiempo restante:</b> {{ gameState?.remainingTime }} seg</p>

      <h4 class="font-semibold mt-4">ğŸ“Œ Marcador</h4>
      <p>ğŸ  {{ gameState?.homeTeam?.name }} ({{ gameState?.homeTeam?.city }}): 
        <b>{{ gameState?.homeScore }}</b></p>
      <p>âœˆï¸ {{ gameState?.awayTeam?.name }} ({{ gameState?.awayTeam?.city }}): 
        <b>{{ gameState?.awayScore }}</b></p>

      <h4 class="font-semibold mt-4">ğŸš¨ Faltas de Equipo</h4>
      <ul>
        <li *ngFor="let foul of gameState?.teamFouls">
          {{ foul.team?.name }} - PerÃ­odo {{ foul.period }}: 
          <b>{{ foul.totalFouls }}</b>
        </li>
      </ul>

      <h4 class="font-semibold mt-4">â›¹ï¸â€â™‚ï¸ Faltas de Jugadores</h4>
      <ul>
        <li *ngFor="let foul of gameState?.playerFouls">
          Jugador #{{ foul.playerId }} - PerÃ­odo {{ foul.period }}: 
          <b>{{ foul.foulCount }}</b>
        </li>
      </ul>

    </div>

    <ng-template #noData>
      <p class="text-gray-500">No hay estado de juego cargado aÃºn.</p>
    </ng-template>

    <button class="bg-blue-600 text-white rounded px-4 py-2 mt-3 hover:bg-blue-700"
            (click)="getFinalState()"
            [disabled]="!gameId || !canInteract">
      Estado Final
    </button>

  </form>
</div>
